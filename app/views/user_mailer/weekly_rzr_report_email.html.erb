<h1 style='text-decoration: underline; text-align: center;'>
  Weekly RZR report for <%= (Time.now - 7.days).strftime('%D')%> - <%=Time.now.strftime('%D')%>
</h1>

<div class="object-title">	
  <h2 style="text-align: center;">In-Service Razors</h2>
</div>
<table>
  <thead>
    <tr>
      <th scope="col">Vehicle Number</th>
      <th scope="col">Status</th>
      <th scope="col">Mileage</th>
      <th scope="col">Location</th>
      <th scope="col">Open Work Orders</th>
      <th scope="col">Near Service - Miles Until:</th>
      <th scope="col">Services Required</th>
    </tr>
  </thead>
  <tbody>
    <% @vehicles.order(veh_category: :asc).each do |vehicle| %>
    <tr>
      <th scope="row"><%= vehicle.car_id %></th>
      <td><%= vehicle.vehicle_status %></td>
      <td><%= vehicle.mileage %></td>
      <td><%= vehicle.location %></td>
      <td>
        <% vehicle.requests.where(status: "New").limit(3).each do |request| %>
        <%=request.number%>
        <%= request.status%>
        <% end %>
      </td>
      <td>
        <% if vehicle.near_service %>
        <ul style="list-style-type:none;padding: 0;margin: 0;">
          <% if vehicle.near_a_service_mileage <= 100 %>
          <li> 
            A-Service in 
            <br />
            <%= vehicle.near_a_service_mileage %> Miles 
          </li> 
          <% end %>
          <%  if vehicle.near_shock_service_mileage <= 200 %> 
          <li>
            Shock Service in
            <br />
            <%= vehicle.near_shock_service_mileage %> Miles
          </li>
          <% end %>
          <% if vehicle.near_air_filter_service_mileage <= 50 %>
          <li>Air Filter Change in
            <br />
            <%= vehicle.near_air_filter_service_mileage %> Miles
          </li>
          <% end %>
          <% end %>
        </ul>
      </td>
      <td>
        <% if vehicle.a_service %>
        A-Service 
        <% end %>
        <% if vehicle.shock_service  %>
        Shock-Service 
        <% end %>
        <% if vehicle.air_filter_service %>
        Air Filter Service 
        <% end %>
        <% if vehicle.repair_needed %>
        Repairs In Progress
        <% end %>
        <% if vehicle.defect %>
        Defect Reported
        <% vehicle.requests.where(program_id: @set_defects.id, status: "New").each do |request|%>
        <br />
        <span style="margin-right: 4px;">
          <strong>
            Description:
          </strong> 
          <%= request.description %>
        </span>
        <% end %>
        <% end %>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>
<br \>
<div>
<div class="object-title">
  <h2 style="text-align: center;">Out-Of-Service Razors</h2>
</div>
<table>
  <thead>
    <tr>
      <th scope="col">Vehicle Number</th>
      <th scope="col">Status</th>
      <th scope="col">Mileage</th>
      <th scope="col">Location</th>
      <th scope="col">Open Work Orders</th>
      <th scope="col">Near Service - Miles Until:</th>
      <th scope="col">Services Required</th>
    </tr>
  </thead>
  <tbody>
    <% @out_of_service.order(veh_category: :asc).each do |vehicle| %>
    <tr>
      <th scope="row"><%= vehicle.car_id %></th>
      <td><%= vehicle.vehicle_status %></td>
      <td><%= vehicle.mileage %></td>
      <td><%= vehicle.location %></td>
      <td><% vehicle.requests.where(status: "New").limit(3).each do |request| %>
        <%=request.number%>
        <%= request.status%>
        <% end %></td>
        <% if vehicle.near_service %>
        <ul style="list-style-type:none;padding: 0;margin: 0;">
          <% if vehicle.near_a_service_mileage <= 100 %>
          <li> 
            A-Service in 
            <br /> <%= vehicle.near_a_service_mileage %> Miles 
          </li> <% end %>
          <%  if vehicle.near_shock_service_mileage <= 200 %> 
          <li>Shock Service in <br /> <%= vehicle.near_shock_service_mileage %> Miles</li>
          <% end %>
          <% if vehicle.near_air_filter_service_mileage <= 50 %>
          <li>Air Filter Change in
            <br />
            <%= vehicle.near_air_filter_service_mileage %> Miles
          </li>
          <% end %>
          <% end %>
        </ul>
      </td>
      <td>
        <% if vehicle.a_service %>
        A-Service 
        <% end %>
        <% if vehicle.shock_service  %>
        Shock-Service 
        <% end %>
        <% if vehicle.air_filter_service %>
        Air Filter Service 
        <% end %>
        <% if vehicle.repair_needed %>
        Repairs In Progress
        <% end %>
        <% if vehicle.defect %>
        Defect Reported
        <% vehicle.requests.where(program_id: @set_defects.id, status: "New").each do |request|%>
        <br />
        <span style="margin-right: 4px;">
          <strong>
            Description:
          </strong> 
          <%= request.description %>
        </span>
        <% end %>
        <% end %>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>
</div>
</div>